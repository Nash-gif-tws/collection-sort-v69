// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/**
 * --- existing session table (kept) ---
 */
model Session {
  id            String    @id
  shop          String
  state         String
  isOnline      Boolean   @default(false)
  scope         String?
  expires       DateTime?
  accessToken   String
  userId        BigInt?
  firstName     String?
  lastName      String?
  email         String?
  accountOwner  Boolean   @default(false)
  locale        String?
  collaborator  Boolean?  @default(false)
  emailVerified Boolean?  @default(false)
}

/**
 * --- analytics MVP tables ---
 */
model Product {
  id          String        @id // Shopify gid
  title       String
  vendor      String?
  createdAt   DateTime?
  variants    Variant[]
  ProductAttr ProductAttr[]
}

model Variant {
  id        String   @id // Shopify gid
  productId String
  product   Product  @relation(fields: [productId], references: [id])
  title     String?
  sku       String?
  size      String? // option1 (if used)
  color     String? // option2 (if used)
  updatedAt DateTime @updatedAt

  @@index([productId])
}

model OrderLine {
  id        String   @id // Shopify lineItem gid
  orderId   String
  createdAt DateTime
  productId String?
  variantId String?
  qty       Int
  currency  String
  netAmount Decimal  @db.Decimal(18, 2)

  @@index([createdAt])
  @@index([productId])
  @@index([variantId])
}

model IngestCursor {
  shop      String   @id
  sinceISO  String
  updatedAt DateTime @updatedAt
}

model ProductAttr {
  productId String  @id
  category  String?
  season    String?
  gender    String?
  lifecycle String? // e.g. NEW_IN | CORE | MARKDOWN
  product   Product @relation(fields: [productId], references: [id])
}

model InventorySnapshot {
  id           String   @id @default(cuid())
  snapshotDate DateTime // store midnight UTC for dedupe
  productId    String
  variantId    String
  onHand       Int
  price        Decimal? @db.Decimal(10, 2)
  cost         Decimal? @db.Decimal(10, 2)

  @@index([snapshotDate])
  @@index([variantId, snapshotDate])
}
